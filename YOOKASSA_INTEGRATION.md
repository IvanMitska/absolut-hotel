# Инструкция по настройке интеграции с ЮКассой

## 1. Подготовка ЮКассы

1. Зарегистрируйтесь на [yookassa.ru](https://yookassa.ru)
2. В личном кабинете создайте магазин
3. Подключите ваш расчётный счёт в Альфа-Банке
4. В разделе "Интеграция" получите:
   - `shopId` (идентификатор магазина)
   - `secretKey` (секретный ключ)

## 2. Настройка в ЮКассе

В личном кабинете ЮКассы настройте:

1. **HTTP-уведомления** (webhook):
   - URL: `https://absolute-hotel-vityazevo.ru/.netlify/functions/payment-webhook`
   - События: payment.succeeded, payment.canceled

2. **Разрешённые способы оплаты**:
   - Банковские карты
   - ЮMoney (опционально)
   - СБП (опционально)

3. **Настройки безопасности**:
   - Включите проверку подписи уведомлений
   - Добавьте ваш домен в белый список

## 3. Настройка переменных окружения в Netlify

1. Войдите в админку Netlify
2. Выберите ваш сайт
3. Перейдите в Site settings → Environment variables
4. Добавьте следующие переменные:

```
YOOKASSA_SHOP_ID = ваш_shop_id
YOOKASSA_SECRET_KEY = ваш_secret_key
URL = https://absolute-hotel-vityazevo.ru
```

## 4. Установка зависимостей

Выполните команду для установки новых зависимостей:

```bash
npm install
```

## 5. Деплой

1. Закоммитьте изменения:
```bash
git add .
git commit -m "feat: добавлена интеграция с ЮКассой"
git push
```

2. Netlify автоматически задеплоит изменения

## 6. Тестирование

### Тестовый режим ЮКассы

Для тестирования используйте тестовые карты:
- Успешный платёж: 5555 5555 5555 4444
- Неуспешный платёж: 5555 5555 5555 4446

### Проверка работы:

1. Зайдите на страницу бронирования
2. Заполните форму
3. Выберите "Онлайн оплата"
4. Проверьте редирект на страницу оплаты ЮКассы
5. После оплаты проверьте редирект обратно на сайт

## 7. Мониторинг

В личном кабинете ЮКассы вы можете:
- Просматривать все платежи
- Скачивать отчёты
- Настраивать уведомления на email

## Структура интеграции

```
/netlify/functions/
├── create-payment.ts     # Создание платежа
├── payment-webhook.ts    # Обработка уведомлений от ЮКассы
└── payment-status.ts     # Проверка статуса платежа

/src/
├── components/ui/
│   └── PaymentMethodSelector.tsx  # Выбор способа оплаты
├── pages/
│   ├── BookingPage.tsx           # Обновлена для работы с платежами
│   └── PaymentResultPage.tsx     # Страница результата оплаты
```

## Безопасность

1. **Никогда** не размещайте секретный ключ в коде
2. Всегда проверяйте подпись webhook-уведомлений
3. Используйте HTTPS для всех запросов
4. Логируйте все операции с платежами

## Поддержка

При возникновении проблем:
1. Проверьте логи в Netlify Functions
2. Проверьте статус платежа в личном кабинете ЮКассы
3. Обратитесь в поддержку ЮКассы: support@yookassa.ru